
@{
    ViewData["Title"] = "FormList";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
    // Get token from session safely
    var jwtToken = Context.Session.GetString("JWTToken");
}

<style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      border-radius: 10px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
</style>

<h2 class="mb-4 text-center">📋 Available Exam Forms</h2>

<div id="formList" class="row g-3 justify-content-center">
    <!-- Cards will load here -->
</div>



<script>
    document.addEventListener("DOMContentLoaded", async () => {
      const formListDiv = document.getElementById("formList");

          const token = '@jwtToken'.trim();

      if (!token) {
        formListDiv.innerHTML = `
          <div class="alert alert-warning text-center">No token found. Please log in again.</div>
        `;
        return;
      }

      try {
            const response = await fetch("https://localhost:7267/api/Form/Formlist", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });

        const result = await response.json();
        console.log(result);

        if (result.success && Array.isArray(result.data)) {
          formListDiv.innerHTML = result.data.map(form => `
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-primary">${form.title}</h5>
                  <p class="card-text">${form.description}</p>
                  <p><strong>Fee:</strong> ₹${form.fee.toFixed(2)}</p>
                                        <button class="btn btn-success w-100 apply-btn" data-id="${form.id}">
                          Apply Now
                        </button>

                </div>
              </div>
            </div>
          `).join("");

                // ✅ Add click listener for each "Apply Now" button
                document.querySelectorAll(".apply-btn").forEach(btn => {
                    btn.addEventListener("click", (e) => {
                        const formId = e.target.getAttribute("data-id");
                        // Redirect to user/form/{id}
                        window.location.href = `/user/FillForm/${formId}`;
                    });
                });

        } else {
          formListDiv.innerHTML = `
            <div class="alert alert-danger text-center">No forms found.</div>
          `;
        }
      } catch (err) {
        console.error(err);
        formListDiv.innerHTML = `
          <div class="alert alert-danger text-center">
            Failed to fetch forms. Please try again later.
          </div>
        `;
      }
    });
</script>